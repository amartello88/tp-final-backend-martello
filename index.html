<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hola!</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #fdf6f0;
      --surface: #fff9f5;
      --surface2: #faeee4;
      --border: #e8d5c4;
      --accent: #c9a882;
      --accent2: #a8c4b8;
      --accent3: #d4a5b5;
      --text: #3d2e22;
      --muted: #a08070;
      --danger: #d4786a;
      --success: #7ab5a0;
    }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

    #auth-screen {
      min-height: 100vh; display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #fdf0e8 0%, #f0e8f5 50%, #e8f0f5 100%);
    }
    .auth-box {
      width: 100%; max-width: 420px; padding: 48px 40px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 16px; box-shadow: 0 8px 40px rgba(180,140,110,0.12);
    }
    .auth-title { font-family: 'Playfair Display', serif; font-size: 2.4rem; color: var(--text); margin-bottom: 4px; }
    .auth-subtitle { color: var(--muted); font-size: 0.85rem; margin-bottom: 32px; }
    .tabs { display: flex; margin-bottom: 28px; border-bottom: 1px solid var(--border); }
    .tab {
      padding: 10px 24px; background: none; border: none; color: var(--muted);
      font-family: 'DM Sans', sans-serif; font-size: 0.9rem; cursor: pointer;
      transition: all 0.2s; border-bottom: 2px solid transparent; margin-bottom: -1px;
    }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .form-group { margin-bottom: 18px; }
    label { display: block; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 8px; }
    input, select {
      width: 100%; padding: 12px 16px; background: var(--surface2);
      border: 1px solid var(--border); border-radius: 8px; color: var(--text);
      font-family: 'DM Sans', sans-serif; font-size: 0.95rem; outline: none; transition: border-color 0.2s;
    }
    input:focus, select:focus { border-color: var(--accent); }
    .btn {
      width: 100%; padding: 13px; background: var(--accent); color: white; border: none;
      border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 0.95rem;
      font-weight: 500; cursor: pointer; transition: all 0.2s; margin-top: 8px;
    }
    .btn:hover { background: #b8956e; transform: translateY(-1px); box-shadow: 0 4px 16px rgba(180,140,110,0.25); }
    .btn:active { transform: translateY(0); }
    .btn-danger { background: var(--danger); width: auto; padding: 6px 14px; font-size: 0.75rem; margin-top: 0; border-radius: 6px; }
    .btn-danger:hover { background: #c06858; box-shadow: none; }
    .msg { padding: 10px 14px; margin-bottom: 16px; font-size: 0.85rem; border-radius: 8px; display: none; }
    .msg.error { background: rgba(212,120,106,0.1); border-left: 3px solid var(--danger); color: var(--danger); display: block; }
    .msg.success { background: rgba(122,181,160,0.1); border-left: 3px solid var(--success); color: var(--success); display: block; }

    #app-screen { display: none; }
    header {
      background: var(--surface); border-bottom: 1px solid var(--border);
      padding: 0 40px; display: flex; align-items: center; justify-content: space-between;
      height: 64px; position: sticky; top: 0; z-index: 100;
      box-shadow: 0 2px 12px rgba(180,140,110,0.08);
    }
    .logo { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--text); }
    .logo span { color: var(--muted); font-size: 0.8rem; font-family: 'DM Sans', sans-serif; margin-left: 10px; }
    .header-right { display: flex; align-items: center; gap: 16px; }
    .user-badge { font-size: 0.8rem; color: var(--muted); }
    .btn-logout {
      padding: 8px 18px; background: transparent; border: 1px solid var(--border);
      border-radius: 8px; color: var(--muted); font-family: 'DM Sans', sans-serif;
      font-size: 0.8rem; cursor: pointer; transition: all 0.2s; width: auto; margin-top: 0;
    }
    .btn-logout:hover { border-color: var(--danger); color: var(--danger); transform: none; box-shadow: none; }
    main { max-width: 1200px; margin: 0 auto; padding: 40px; }
    .section-title {
      font-family: 'Playfair Display', serif; font-size: 1.6rem; margin-bottom: 24px;
      color: var(--text); display: flex; align-items: center; gap: 14px;
    }
    .section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }
    .count-badge { background: var(--accent2); color: white; font-size: 0.75rem; padding: 2px 10px; border-radius: 20px; font-weight: 500; }
    .filters {
      display: flex; gap: 12px; margin-bottom: 28px; flex-wrap: wrap; align-items: flex-end;
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px;
    }
    .filter-group { display: flex; flex-direction: column; gap: 6px; }
    .filter-group label { margin-bottom: 0; }
    .filter-group input { width: 160px; }
    .btn-filter { padding: 12px 24px; width: auto; margin-top: 0; background: var(--accent2); }
    .btn-filter:hover { background: #8fada2; }
    .btn-clear {
      padding: 12px 18px; width: auto; margin-top: 0; background: transparent;
      border: 1px solid var(--border); border-radius: 8px; color: var(--muted);
      font-family: 'DM Sans', sans-serif; cursor: pointer; transition: all 0.2s;
    }
    .btn-clear:hover { border-color: var(--accent); color: var(--accent); }
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(270px, 1fr)); gap: 20px; margin-bottom: 48px; }
    .product-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 24px; transition: all 0.2s; animation: fadeIn 0.3s ease;
    }
    .product-card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 8px 24px rgba(180,140,110,0.12); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    .product-category { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: var(--accent3); margin-bottom: 8px; font-weight: 500; }
    .product-name { font-family: 'Playfair Display', serif; font-size: 1.1rem; margin-bottom: 8px; }
    .product-desc { font-size: 0.8rem; color: var(--muted); margin-bottom: 16px; line-height: 1.5; }
    .product-footer { display: flex; align-items: center; justify-content: space-between; }
    .product-price { font-family: 'Playfair Display', serif; font-size: 1.4rem; color: var(--accent); }
    .product-stock { font-size: 0.72rem; color: var(--muted); margin-bottom: 6px; text-align: right; }
    .product-stock.low { color: var(--danger); }
    .create-section { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 32px; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-grid .full { grid-column: 1 / -1; }
    .btn-create { margin-top: 8px; background: var(--accent3); }
    .btn-create:hover { background: #c090a2; }
    .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); grid-column: 1 / -1; }
    .empty-state .big { font-family: 'Playfair Display', serif; font-size: 3rem; color: var(--border); margin-bottom: 8px; }
    .loading { text-align: center; padding: 40px; color: var(--muted); font-style: italic; grid-column: 1 / -1; }
  </style>
</head>
<body>

<div id="auth-screen">
  <div class="auth-box">
    <div class="auth-title">Hola! üëã</div>
    <div class="auth-subtitle">Panel de gesti√≥n ‚Äî API UTN Backend</div>
    <div class="tabs">
      <button class="tab active" onclick="switchTab('login')">Iniciar sesi√≥n</button>
      <button class="tab" onclick="switchTab('register')">Registrarse</button>
    </div>
    <div id="auth-msg" class="msg"></div>
    <div id="tab-login">
      <div class="form-group"><label>Email</label><input type="email" id="login-email" placeholder="tu@email.com" /></div>
      <div class="form-group"><label>Contrase√±a</label><input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" /></div>
      <button class="btn" onclick="login()">Entrar</button>
      <p style="text-align:center; margin-top:16px; font-size:0.8rem; color:var(--muted);">Creado por Ayelen Martello üíñ</p>
      
    </div>
    <div id="tab-register" style="display:none">
      <div class="form-group"><label>Nombre de usuario</label><input type="text" id="reg-username" placeholder="Tu nombre" /></div>
      <div class="form-group"><label>Email</label><input type="email" id="reg-email" placeholder="tu@email.com" /></div>
      <div class="form-group"><label>Contrase√±a</label><input type="password" id="reg-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" /></div>
      <button class="btn" onclick="register()">Crear cuenta</button>
    </div>
  </div>
</div>

<div id="app-screen">
  <header>
    <div class="logo">Hola! <span>UTN Backend</span></div>
    <div class="header-right">
      <span class="user-badge" id="user-info"></span>
      <button class="btn-logout" onclick="logout()">Salir</button>
    </div>
  </header>
  <main>
    <div class="section-title">Productos <span class="count-badge" id="product-count">0</span></div>
    <div class="filters">
      <div class="filter-group"><label>Precio m√≠nimo</label><input type="number" id="f-minPrice" placeholder="0" /></div>
      <div class="filter-group"><label>Precio m√°ximo</label><input type="number" id="f-maxPrice" placeholder="99999" /></div>
      <div class="filter-group"><label>Nombre</label><input type="text" id="f-name" placeholder="Buscar..." /></div>
      <button class="btn btn-filter" onclick="loadProducts()">Buscar</button>
      <button class="btn-clear" onclick="clearFilters()">Limpiar</button>
    </div>
    <div id="products-container" class="products-grid"><div class="loading">Cargando productos...</div></div>
    <div class="section-title">Nuevo Producto</div>
    <div class="create-section">
      <div id="create-msg" class="msg"></div>
      <div class="form-grid">
        <div class="form-group"><label>Nombre *</label><input type="text" id="c-name" placeholder="Nombre del producto" /></div>
        <div class="form-group"><label>Precio *</label><input type="number" id="c-price" placeholder="0" /></div>
        <div class="form-group"><label>Stock *</label><input type="number" id="c-stock" placeholder="0" /></div>
        <div class="form-group"><label>Categor√≠a (ID) *</label><input type="text" id="c-category" placeholder="ID de la categor√≠a" /></div>
        <div class="form-group full"><label>Descripci√≥n</label><input type="text" id="c-description" placeholder="Descripci√≥n del producto" /></div>
      </div>
      <button class="btn btn-create" onclick="createProduct()">+ Agregar producto</button>
    </div>
  </main>
</div>

<script>
  const API = 'http://localhost:3000';
  let token = localStorage.getItem('token');
  let currentUser = localStorage.getItem('user');
  if (token) showApp();

  function showApp() {
    document.getElementById('auth-screen').style.display = 'none';
    document.getElementById('app-screen').style.display = 'block';
    if (currentUser) document.getElementById('user-info').textContent = currentUser;
    loadProducts();
  }
  function showAuth() {
    document.getElementById('auth-screen').style.display = 'flex';
    document.getElementById('app-screen').style.display = 'none';
  }
  function switchTab(tab) {
    document.getElementById('tab-login').style.display = tab === 'login' ? 'block' : 'none';
    document.getElementById('tab-register').style.display = tab === 'register' ? 'block' : 'none';
    document.querySelectorAll('.tab').forEach((t, i) => {
      t.classList.toggle('active', (i === 0 && tab === 'login') || (i === 1 && tab === 'register'));
    });
    showMsg('auth-msg', '', '');
  }
  function showMsg(id, text, type) {
    const el = document.getElementById(id);
    el.textContent = text;
    el.className = 'msg ' + type;
  }
  async function login() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    if (!email || !password) return showMsg('auth-msg', 'Complet√° todos los campos', 'error');
    try {
      const res = await fetch(`${API}/auth/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });
      const data = await res.json();
      if (!res.ok || !data.success) throw new Error(data.error || 'Error al iniciar sesi√≥n');
      token = data.data;
      localStorage.setItem('token', token);
      localStorage.setItem('user', email);
      currentUser = email;
      showApp();
    } catch (e) { showMsg('auth-msg', e.message, 'error'); }
  }
  async function register() {
    const username = document.getElementById('reg-username').value;
    const email = document.getElementById('reg-email').value;
    const password = document.getElementById('reg-password').value;
    if (!username || !email || !password) return showMsg('auth-msg', 'Complet√° todos los campos', 'error');
    try {
      const res = await fetch(`${API}/auth/register`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, email, password }) });
      const data = await res.json();
      if (!res.ok || !data.success) throw new Error(data.error || 'Error al registrarse');
      showMsg('auth-msg', '¬°Cuenta creada! Ahora pod√©s iniciar sesi√≥n', 'success');
      switchTab('login');
    } catch (e) { showMsg('auth-msg', e.message, 'error'); }
  }
  function logout() {
    token = null;
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    showAuth();
  }
  async function loadProducts() {
    const minPrice = document.getElementById('f-minPrice').value;
    const maxPrice = document.getElementById('f-maxPrice').value;
    const name = document.getElementById('f-name').value;
    let url = `${API}/products?`;
    if (minPrice) url += `minPrice=${minPrice}&`;
    if (maxPrice) url += `maxPrice=${maxPrice}&`;
    if (name) url += `name=${encodeURIComponent(name)}&`;
    const container = document.getElementById('products-container');
    container.innerHTML = '<div class="loading">Cargando...</div>';
    try {
      const res = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
      if (res.status === 401) { logout(); return; }
      const products = await res.json();
      document.getElementById('product-count').textContent = products.length;
      if (!products.length) {
        container.innerHTML = `<div class="empty-state"><div class="big">Sin resultados</div><p>No hay productos con esos filtros</p></div>`;
        return;
      }
      container.innerHTML = products.map(p => `
        <div class="product-card">
          <div class="product-category">${p.category?.name || 'Sin categor√≠a'}</div>
          <div class="product-name">${p.name}</div>
          <div class="product-desc">${p.description || ''}</div>
          <div class="product-footer">
            <div class="product-price">$${p.price?.toLocaleString('es-AR')}</div>
            <div>
              <div class="product-stock ${p.stock < 10 ? 'low' : ''}">Stock: ${p.stock}</div>
              <button class="btn btn-danger" onclick="deleteProduct('${p._id}')">Eliminar</button>
            </div>
          </div>
        </div>`).join('');
    } catch (e) { container.innerHTML = '<div class="loading">Error al cargar productos</div>'; }
  }
  function clearFilters() {
    ['f-minPrice','f-maxPrice','f-name'].forEach(id => document.getElementById(id).value = '');
    loadProducts();
  }
  async function createProduct() {
    const name = document.getElementById('c-name').value;
    const price = Number(document.getElementById('c-price').value);
    const stock = Number(document.getElementById('c-stock').value);
    const category = document.getElementById('c-category').value;
    const description = document.getElementById('c-description').value;
    if (!name || !price || !stock || !category) return showMsg('create-msg', 'Complet√° los campos obligatorios (*)', 'error');
    try {
      const res = await fetch(`${API}/products`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify({ name, price, stock, category, description })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Error al crear producto');
      showMsg('create-msg', '¬°Producto creado con √©xito!', 'success');
      ['c-name','c-price','c-stock','c-category','c-description'].forEach(id => document.getElementById(id).value = '');
      loadProducts();
    } catch (e) { showMsg('create-msg', e.message, 'error'); }
  }
  async function deleteProduct(id) {
    if (!confirm('¬øEliminar este producto?')) return;
    try {
      const res = await fetch(`${API}/products/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
      if (!res.ok) throw new Error('Error al eliminar');
      loadProducts();
    } catch (e) { alert(e.message); }
  }
  document.addEventListener('keydown', e => {
    if (e.key === 'Enter' && document.getElementById('tab-login').style.display !== 'none') login();
  });
</script>
</body>
</html>